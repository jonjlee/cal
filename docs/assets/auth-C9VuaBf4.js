import{v as s,J as i,K as h,y as a}from"./db-gBYaOoHZ.js";class n{constructor(e,t){this.currentPage=e;const r=new URLSearchParams(t);this.accessCode=r.get("c"),this.deptId=r.get("d"),this.user=null,this.auth=this._beginAuth(),this.auth.redirect="#"}async _beginAuth(){var e;if(this.user=await s(!0),this.user&&this.deptId&&await i(this.deptId))return{user:this.user,deptId:this.deptId};if(this.accessCode){const t=await h(this.accessCode);if(t.user&&t.deptId!=null)return this.user=t.user,this.deptId=t.deptId,t;throw this.auth.redirect="./login.html",new Error("Invalid access code, redirect")}if(this.user){const t=await a();throw((e=t.data)==null?void 0:e.length)>0?(this.auth.redirect=`./${this.currentPage}?d=${t.data[0].id}`,new Error("Invalid department, redirect")):(this.auth.redirect="./dept.html",new Error("No departments, redirect"))}throw this.auth.redirect="./login.html",new Error("User not authenticated, redirect")}}export{n as A};
